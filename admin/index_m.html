<html>
<link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>
<link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">

<script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../socket.io/socket.io.js"></script>

<script type="text/javascript" src="../../js/translate.js"></script>
<script type="text/javascript" src="../../lib/js/materialize.js"></script>
<script type="text/javascript" src="../../js/adapter-settings.js"></script>
<script type="text/javascript" src="words.js"></script>


<style>
    .table_header {
        background-color: blue;
        color: white;
    }
    .ip {
        width: 150px;
        text-align: right;
    }
</style>
<!-- you have to define 2 functions in the global scope: -->
<script type="text/javascript">
    var setup = [];

    // the function loadSettings has to exist ...
    function save(callback) {
            var obj = {};
            $('.value').each(function () {
                var $this = $(this);
                var id = $this.attr('id');
                if ($this.attr('type') === 'checkbox') {
                    obj[$this.attr('id')] = $this.prop('checked');
                } else {
                    obj[$this.attr('id')] = $this.val();
                }
            });
            callback(obj);
        }
    
        function load(settings, onChange) {
            if (!settings) return;
            $('.value').each(function () {
                var key = $(this).attr('id');
                var $key = $('#' + key + '.value');
                if ($key.attr('type') === 'checkbox') {
                    $key.prop('checked', settings[key]).change(function () {
                        onChange();
                    });
                } else {
                    $key.val(settings[key]).change(function () {
                        onChange();
                    }).keyup(function () {
                        onChange();
                    });
                }
            });
            onChange(false);


            $('#loadRegions').on('click', function () {
                var $loadRegions = $('#loadRegions');
                let country = $('#country').val();
                //showToast(_('pressed loadregions for'   + country));
                console.log("pressed loadregions for  " + country);

                let xml = requestXML('https://www.meteoalarm.eu/documents/rss/at.rss')
                let name = $(xml).find("title").text();

                showToast(_('received callback: '   + name)); 
            });
        }

        function requestXML(theUrl, callback)
        {
           var xmlHttp = new XMLHttpRequest();
           xmlHttp.onreadystatechange = function() { 
           if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
               return callback(xmlHttp.responseText);
            }
            xmlHttp.open("GET", theUrl, true); // true for asynchronous 
            xmlHttp.send(null);
        }
</script>
<style>
    .m .select-wrapper+label {
        top: 100%;
    }
</style>
</head>
<body>
<div class="m adapter-container">
    <div class="row">
        <div class="row">
            <div class="input-field col s3">
                <img src="meteoalarm.png" class="logo">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="input-field col s12 m4 l2 ">
            <select class="value " id="country" type="text">
                <option value="" disabled selected class="translate">country</option>
                <option value="AT">Austria</option>
                <option value="DE">Germany</option>
                <option value="CH">Switzerland</option>
                <option value="FI">Finnland</option>
            </select>
            <label class="translate" for="country">country</label>
        </div>
        <div class="col s5 m3 l2">
            <a id="loadRegions" class=" btn-small translate">load regions<span></span></a>
        </div>
    </div>
    <div class="row">
        <div class="col s12 m12 l12 input-field">
            <select class="value " id="regions" type="text">
                <option value="" disabled selected class="translate">Please select Country first</option>
            </select>
            <label class="translate" for="regions">regions</label>
        </div>
    </div>
    <div class="row">
        <div class="input-field col s12">
            <input type="text" id="pathXML" class="value" />
            <label for="pathXML" class="translate">AddPath</label>
        </div>
    </div>
    <div class="row">
        <div class="col s12">
            <span class="translate">instruction</span>
        </div>
    </div>
</div>
</body>
</html>