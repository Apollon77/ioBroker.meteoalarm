<html>
<link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>
<link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">

<script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../../socket.io/socket.io.js"></script>

<script type="text/javascript" src="../../js/translate.js"></script>
<script type="text/javascript" src="../../lib/js/materialize.js"></script>
<script type="text/javascript" src="../../js/adapter-settings.js"></script>
<script type="text/javascript" src="words.js"></script>


<style>
    .table_header {
        background-color: blue;
        color: white;
    }
    .ip {
        width: 150px;
        text-align: right;
    }
</style>
<!-- you have to define 2 functions in the global scope: -->
<script type="text/javascript">
    var setup = [];

    // the function loadSettings has to exist ...
    function save(callback) {
            var obj = {};
            $('.value').each(function () {
                var $this = $(this);
                var id = $this.attr('id');
                if ($this.attr('type') === 'checkbox') {
                    obj[$this.attr('id')] = $this.prop('checked');
                } else {
                    obj[$this.attr('id')] = $this.val();
                }
            });
            callback(obj);
        }
    
        function load(settings, onChange) {
            if (!settings) return;
            $('.value').each(function () {
                var key = $(this).attr('id');
                var $key = $('#' + key + '.value');
                if ($key.attr('type') === 'checkbox') {
                    $key.prop('checked', settings[key]).change(function () {
                        onChange();
                    });
                } else {
                    $key.val(settings[key]).change(function () {
                        onChange();
                    }).keyup(function () {
                        onChange();
                    });
                }
            });
            onChange(false);


            $('#loadRegions').on('click', function () {
                var $loadRegions = $('#loadRegions');
                let country = $('#country').val();
                //showToast(_('pressed loadregions for'   + country));
                console.log("pressed loadregions for  " + country);
                let url = 'https://www.meteoalarm.eu/documents/rss/' + country + '.rss'
                httpGet(url, function(returnValue) {
                    console.log(returnValue);
                    let xml = returnValue
                    let text = "";
                    
                    //let name = $(xml).find("title").text();
                    //console.log(name);
                    //showToast(_('received callback: '   + httpGet('https://www.meteoalarm.eu/documents/rss/at.rss')));
                    $(xml).find('item').each(function(){
                        text += $(xml).find("title").text()
                        console.log($(this).find('title').text()) // even if data.push is been called before this tempObj will still changes data[i] (because of the same reference thing, got it???)
                    });
                    $('#regions').html(text).select()
                    showToast(_('regions updated'));
                });
            });
        }

        function httpGet(theUrl, callback)
        {
            theUrl =  'https://cors-anywhere.herokuapp.com/' + theUrl
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", theUrl, false ); 
            xmlHttp.send( null );
            callback(xmlHttp.responseXML);
        }           

</script>
<style>
    .m .select-wrapper+label {
        top: 100%;
    }
</style>
</head>
<body>
<div class="m adapter-container">
    <div class="row">
        <div class="row">
            <div class="input-field col s3">
                <img src="meteoalarm.png" class="logo">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="input-field col s12 m4 l2 ">
            <select class="value " id="country" type="text">
                <option value="" disabled selected class="translate">country</option>
                <option value="at">Austria</option>
                <option value="de">Germany</option>
                <option value="ch">Switzerland</option>
                <option value="fi">Finnland</option>
            </select>
            <label class="translate" for="country">country</label>
        </div>
        <div class="col s5 m3 l2">
            <a id="loadRegions" class=" btn-small translate">load regions<span></span></a>
        </div>
    </div>
    <div class="row">
        <div class="col s12 m12 l12 input-field">
            <select class="value " id="regions" type="text">
                <option value="" disabled selected class="translate">Please select Country first</option>
            </select>
            <label class="translate" for="regions">regions</label>
        </div>
    </div>
    <div class="row">
        <div class="input-field col s12">
            <input type="text" id="pathXML" class="value" />
            <label for="pathXML" class="translate">AddPath</label>
        </div>
    </div>
    <div class="row">
        <div class="col s12">
            <span class="translate">instruction</span>
        </div>
    </div>
</div>
</body>
</html>